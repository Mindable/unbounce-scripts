<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Checkout Test Page</title>
</head>
<body>
    <h2>New Checkout Form</h2>
    <div id="checkout-div"
         data-offer-id="1360"
         data-checkout-button-text="Buy Me"
         data-successful-checkout-url="https://flux.astrologyanswers.com/?flux_action=1&flux_f=1061367355000511979&flux_ffn=1095133337314859374"
         data-checkout-form-type="digital"
    ></div>
    <!--    Add VueJS-->
    <script src="https://unpkg.com/vue@next"></script>
    <!--    Add Main App-->
    <script src="main.js"></script>
    <!--    Add Components-->
    <script src="components/checkoutForm.js"></script>
    <script src="components/user-contact.js"></script>
    <script src="components/user-address.js"></script>
    <script src="components/user-payment.js"></script>
    <script src="components/product-pricing.js"></script>
    <!--    Mount App-->
    <script>
        const _urlParams = new URLSearchParams(window.location.search);
        if(document.querySelector(`#checkout-div`)) {
            const _checkoutElement = document.querySelector(`#checkout-div`);
            const _checkoutConfig = getCheckoutConfig(_checkoutElement);

            createCheckoutForm(_checkoutConfig);
        }

        function getCheckoutConfig(_checkoutElem) {
            let config = {};

            config.productVariantId = _checkoutElem.dataset.offerId ?? 0;
            config.submitButtonText = _checkoutElem.dataset.checkoutButtonText ?? 'Buy Me';
            config.checkoutFormType = _checkoutElem.dataset.checkoutFormType ?? 'digital';
            config.paymentSuccessRedirect = _checkoutElem.dataset.successfulCheckoutUrl ?? 'https://astrologyanswers.com';

            config.token = _urlParams.get('token') ?? '';
            config.userHash = _urlParams.get('hash') ?? '';

            config.utm_params = {
                utm_source: _urlParams.get('utm_source') ?? '',
                utm_campaign: _urlParams.get('utm_campaign') ?? '',
                utm_content: _urlParams.get('utm_content') ?? '',
                utm_term: _urlParams.get('utm_term') ?? '',
                utm_medium: _urlParams.get('utm_medium') ?? '',
            } ;

            config.device_id = _urlParams.get('device_id') ?? 1;

            config.tag = _urlParams.get('tag') ?? '';
            config.tag2 = _urlParams.get('tag2') ?? '';

            config.order_page_url = `${window.location.protocol}//${window.location.host}/${window.location.pathname}`;

            return config;
        }

        function createCheckoutForm(_checkoutConfig) {
            const checkoutApp = app.mount('#checkout-div');
            checkoutApp.productVariantId = _checkoutConfig.productVariantId;
            checkoutApp.submitButtonText = _checkoutConfig.submitButtonText;
            checkoutApp.checkoutFormType = _checkoutConfig.checkoutFormType;
            checkoutApp.paymentSuccessRedirect = _checkoutConfig.checkoutFormType;
            checkoutApp.hash = _checkoutConfig.userHash;
            checkoutApp.token = _checkoutConfig.token;
            checkoutApp.utm_params = _checkoutConfig.utm_params;
            checkoutApp.device_id = _checkoutConfig.device_id;
            checkoutApp.tag = _checkoutConfig.tag;
            checkoutApp.tag2 = _checkoutConfig.tag2;
            checkoutApp.order_page_url = _checkoutConfig.order_page_url;
            checkoutApp.updateCheckoutForm();
        }
    </script>
</body>
</html>